<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style2.css" />
    <style>
      * {
        margin: 0;
        padding: 0;
        list-style: none;
      }
      body {
        margin: auto;
        background-color: #acc;
        display: flex;
        text-align: center;
      }
      .container {
        margin: 0em 2em;
        background-color: #fff;
        font-family: "Noto Sans CJK TC", sans-serif;
      }
      .title p {
        text-align: justify;
        padding: 16px;
      }
      .submission {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 10vh;
      }
      #submit_btn {
        background-color: #537363; /* 綠色背景 */
        color: white; /* 白色文字 */
        padding: 10px 23px; /* 按鈕內邊距 */
        text-align: center; /* 文字置中 */
        text-decoration: none; /* 移除文字下劃線 */
        display: inline-block; /* 內聯區塊元素 */
        font-size: 16px; /* 字體大小 */
        margin: 4px 2px; /* 外邊距 */
        cursor: pointer; /* 鼠標指針 */
        border: none; /* 無邊框 */
        border-radius: 8px; /* 圓角 */
      }
    </style>
    <title>迷因</title>
  </head>
  <body>
    <div class="container">
      <div class="title">
        <h1>迷因的幽默與冒犯</h1>
        <br />
        <h4>感謝您撥冗填寫問卷。</h4>
        <p>
          <br />此問卷希望您根據個人主觀判斷以下迷因的
          <b>好笑（幽默）程度</b> 和
          <b>冒犯他人程度</b
          >。「冒犯」的定義包含對人沒有禮貌、得罪或激怒他人，只要讓人覺得被攻擊都算。<b
            >被冒犯者可以是社會上任一生命體、族群或個人，只要你感受到任一個體被冒犯到都算。</b
          ><br />兩者評分標準皆為0-5，0為完全不（好笑/冒犯），5為超級（好笑/冒犯）。<br />
        </p>
        <br />
        <form id="questionnaireForm">
          <label for="set_num">選擇問卷集：</label>
          <select id="set_num" name="set_num"></select>
        </form>
      </div>
      <div id="questions">
        <script src="https://cdn.jsdelivr.net/npm/whatwg-fetch@3.6.2/dist/fetch.umd.js"></script>
        <script src="cor_fetch.js" defer></script>
        <script>
          document.addEventListener("DOMContentLoaded", function () {
            const selectElement = document.getElementById("set_num");
            const questionsContainer = document.getElementById("questions");
            fetch(
              "https://raw.githubusercontent.com/Chilinhung/meme_questionnaire/main/question_set.json"
            )
              .then((response) => response.json())
              .then((images) => {
                populateOptions(images, selectElement);
                selectElement.addEventListener("change", function () {
                  updateQuestions(images, selectElement);
                  console.log("bottom images found");
                });
                if (selectElement.options.length > 0) {
                  selectElement.value = selectElement.options[0].value;
                  selectElement.dispatchEvent(new Event("change"));
                }
              })
              .catch((error) => {
                console.error("Failed to fetch image set:", error);
              });

            function populateOptions(images, selectElement) {
              Object.keys(images).forEach((key) => {
                const option = document.createElement("option");
                option.value = key;
                option.textContent = key.replace("set_", "Set ");
                selectElement.appendChild(option);
              });
              selectElement.dispatchEvent(new Event("change")); // Initialize on first load
              console.log("Options added");
            }
            function updateQuestions(images, selectElement) {
              console.log(
                "Dropdown changed, selected value:",
                selectElement.value
              );
              const setNum = selectElement.value;
              const setImagePaths = images[setNum];
              let allQuestionsHTML = "";
              setImagePaths.forEach((imagePath, index) => {
                allQuestionsHTML += createQuestionHTML(
                  index,
                  imagePath,
                  selectElement
                );
              });
              questionsContainer.innerHTML = allQuestionsHTML;
              console.log("Questions added to container");
              attachRangeInputEvents();
            }
            function updateQuestions(images, selectElement) {
              console.log(
                "Dropdown changed, selected value:",
                selectElement.value
              );
              const setNum = selectElement.value;
              const setImagePaths = images[setNum];
              let allQuestionsHTML = "";
              setImagePaths.forEach((imagePath, index) => {
                allQuestionsHTML += createQuestionHTML(
                  index,
                  imagePath,
                  selectElement
                );
              });
              questionsContainer.innerHTML = allQuestionsHTML;
              console.log("Questions added to container");
              attachRangeInputEvents();
            }

            function createQuestionHTML(index, imagePath, selectElement) {
              return `
                        <div class="questions">
                            <br />
                            <h3>Question ${index + 1}</h3> 
                            <div class= "content">
                                <img src="https://raw.githubusercontent.com/Chilinhung/meme_questionnaire/main/images/${imagePath}" alt="Meme image for question ${index + 1}" style="max-width: 35%; height: auto;">
                                <div class="question-text">
                                    <p>這個迷因的好笑程度你給幾分？</p>
                                    <div class="slider-container">
                                        <input type="range" class="question-input" data-question-id="${
                                          selectElement.value
                                        }_q${index + 1}" data-aspect="humor" min="0" max="5" value="0"> 
                                        <div class="slider-marks">
                                            <span>0</span>
                                            <span>1</span>
                                            <span>2</span>
                                            <span>3</span>
                                            <span>4</span>
                                            <span>5</span>
                                        </div>
                                    </div>
                                    <p>這個迷因的冒犯程度你給幾分？</p>
                                    <div class="slider-container">
                                        <input type="range" class="question-input" data-question-id="${
                                          selectElement.value
                                        }_q${index + 1}" data-aspect="offensive" min="0" max="5" value="0">
                                        <div class="slider-marks">
                                            <span>0</span>
                                            <span>1</span>
                                            <span>2</span>
                                            <span>3</span>
                                            <span>4</span>
                                            <span>5</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
            }

            function attachRangeInputEvents() {
              document
                .querySelectorAll('.slider-container input[type="range"]')
                .forEach((input) => {
                  input.addEventListener("input", function () {
                    console.log("Slider value: ", this.value);
                  });
                });
            }
          });
        </script>
      </div>
      <br /><br /><br />
      <div class="submission">
        <button type="button" id="submit_btn">提交問卷</button>
      </div>
    </div>
  </body>
</html>
